$(function() {
consoleInit(main)
  });

const HANDLER_ABI = [{"inputs":[{"internalType":"address","name":"_factory","type":"address"},{"internalType":"bytes32","name":"_pool_init_code_hash","type":"bytes32"},{"internalType":"address","name":"_swapRouter","type":"address"}],"stateMutability":"nonpayable","type":"constructor"},{"inputs":[],"name":"T","type":"error"},{"inputs":[],"name":"UniswapV3SingleTickLiquidityHandlerV2__BeforeReserveCooldown","type":"error"},{"inputs":[],"name":"UniswapV3SingleTickLiquidityHandlerV2__InRangeLP","type":"error"},{"inputs":[],"name":"UniswapV3SingleTickLiquidityHandlerV2__InsufficientLiquidity","type":"error"},{"inputs":[],"name":"UniswapV3SingleTickLiquidityHandlerV2__NotWhitelisted","type":"error"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"owner","type":"address"},{"indexed":true,"internalType":"address","name":"spender","type":"address"},{"indexed":true,"internalType":"uint256","name":"id","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"}],"name":"Approval","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"uint256","name":"tokenId","type":"uint256"},{"indexed":false,"internalType":"uint128","name":"liquidityBurned","type":"uint128"},{"indexed":false,"internalType":"address","name":"pool","type":"address"},{"indexed":false,"internalType":"address","name":"hook","type":"address"},{"indexed":false,"internalType":"address","name":"user","type":"address"},{"indexed":false,"internalType":"int24","name":"tickLower","type":"int24"},{"indexed":false,"internalType":"int24","name":"tickUpper","type":"int24"}],"name":"LogBurnedPosition","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"uint256","name":"tokenId","type":"uint256"},{"indexed":false,"internalType":"uint128","name":"liquidityDonated","type":"uint128"}],"name":"LogDonation","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"address","name":"handler","type":"address"},{"indexed":false,"internalType":"contract IUniswapV3Pool","name":"pool","type":"address"},{"indexed":false,"internalType":"uint256","name":"tokenId","type":"uint256"},{"indexed":false,"internalType":"int24","name":"tickLower","type":"int24"},{"indexed":false,"internalType":"int24","name":"tickUpper","type":"int24"},{"indexed":false,"internalType":"uint128","name":"liquidity","type":"uint128"}],"name":"LogFeeCompound","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"uint256","name":"tokenId","type":"uint256"},{"indexed":false,"internalType":"uint128","name":"liquidityMinted","type":"uint128"},{"indexed":false,"internalType":"address","name":"pool","type":"address"},{"indexed":false,"internalType":"address","name":"hook","type":"address"},{"indexed":false,"internalType":"address","name":"user","type":"address"},{"indexed":false,"internalType":"int24","name":"tickLower","type":"int24"},{"indexed":false,"internalType":"int24","name":"tickUpper","type":"int24"}],"name":"LogMintedPosition","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"uint256","name":"tokenId","type":"uint256"},{"indexed":false,"internalType":"uint128","name":"liquidityReserved","type":"uint128"},{"indexed":false,"internalType":"address","name":"user","type":"address"}],"name":"LogReservedLiquidity","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"uint256","name":"tokenId","type":"uint256"},{"indexed":false,"internalType":"uint128","name":"liquidityUnused","type":"uint128"}],"name":"LogUnusePosition","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"address","name":"_app","type":"address"},{"indexed":false,"internalType":"bool","name":"_status","type":"bool"}],"name":"LogUpdateWhitelistedApp","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"uint64","name":"_newLockedBlockDuration","type":"uint64"},{"indexed":false,"internalType":"uint64","name":"_newReserveCooldown","type":"uint64"}],"name":"LogUpdatedLockBlockAndReserveCooldownDuration","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"uint256","name":"tokenId","type":"uint256"},{"indexed":false,"internalType":"uint128","name":"liquidityUsed","type":"uint128"}],"name":"LogUsePosition","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"uint256","name":"tokenId","type":"uint256"},{"indexed":false,"internalType":"uint128","name":"liquidityWithdrawn","type":"uint128"},{"indexed":false,"internalType":"address","name":"user","type":"address"}],"name":"LogWithdrawReservedLiquidity","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"owner","type":"address"},{"indexed":true,"internalType":"address","name":"operator","type":"address"},{"indexed":false,"internalType":"bool","name":"approved","type":"bool"}],"name":"OperatorSet","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"address","name":"account","type":"address"}],"name":"Paused","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"bytes32","name":"role","type":"bytes32"},{"indexed":true,"internalType":"bytes32","name":"previousAdminRole","type":"bytes32"},{"indexed":true,"internalType":"bytes32","name":"newAdminRole","type":"bytes32"}],"name":"RoleAdminChanged","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"bytes32","name":"role","type":"bytes32"},{"indexed":true,"internalType":"address","name":"account","type":"address"},{"indexed":true,"internalType":"address","name":"sender","type":"address"}],"name":"RoleGranted","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"bytes32","name":"role","type":"bytes32"},{"indexed":true,"internalType":"address","name":"account","type":"address"},{"indexed":true,"internalType":"address","name":"sender","type":"address"}],"name":"RoleRevoked","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"address","name":"caller","type":"address"},{"indexed":true,"internalType":"address","name":"from","type":"address"},{"indexed":true,"internalType":"address","name":"to","type":"address"},{"indexed":true,"internalType":"uint256","name":"id","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"}],"name":"Transfer","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"address","name":"account","type":"address"}],"name":"Unpaused","type":"event"},{"inputs":[],"name":"DEFAULT_ADMIN_ROLE","outputs":[{"internalType":"bytes32","name":"","type":"bytes32"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"POOL_INIT_CODE_HASH","outputs":[{"internalType":"bytes32","name":"","type":"bytes32"}],"stateMutability":"view","type":"function"},{"inputs":[{"components":[{"internalType":"address","name":"token0","type":"address"},{"internalType":"address","name":"token1","type":"address"},{"internalType":"uint24","name":"fee","type":"uint24"},{"internalType":"address","name":"recipient","type":"address"},{"internalType":"int24","name":"tickLower","type":"int24"},{"internalType":"int24","name":"tickUpper","type":"int24"},{"internalType":"uint256","name":"amount0Desired","type":"uint256"},{"internalType":"uint256","name":"amount1Desired","type":"uint256"},{"internalType":"uint256","name":"amount0Min","type":"uint256"},{"internalType":"uint256","name":"amount1Min","type":"uint256"}],"internalType":"struct LiquidityManager.AddLiquidityParams","name":"params","type":"tuple"}],"name":"addLiquidity","outputs":[{"internalType":"uint128","name":"liquidity","type":"uint128"},{"internalType":"uint256","name":"amount0","type":"uint256"},{"internalType":"uint256","name":"amount1","type":"uint256"},{"internalType":"contract IUniswapV3Pool","name":"pool","type":"address"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"},{"internalType":"address","name":"","type":"address"},{"internalType":"uint256","name":"","type":"uint256"}],"name":"allowance","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"spender","type":"address"},{"internalType":"uint256","name":"id","type":"uint256"},{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"approve","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"},{"internalType":"uint256","name":"","type":"uint256"}],"name":"balanceOf","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"context","type":"address"},{"internalType":"bytes","name":"_burnPositionData","type":"bytes"}],"name":"burnPositionHandler","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint128","name":"shares","type":"uint128"},{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"convertToAssets","outputs":[{"internalType":"uint128","name":"","type":"uint128"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint128","name":"assets","type":"uint128"},{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"convertToShares","outputs":[{"internalType":"uint128","name":"","type":"uint128"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes","name":"_donateData","type":"bytes"}],"name":"donateToPosition","outputs":[{"internalType":"uint256[]","name":"","type":"uint256[]"},{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"emergencyPause","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"emergencyUnpause","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"factory","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"contract IUniswapV3Pool","name":"pool","type":"address"},{"internalType":"int24","name":"tickLower","type":"int24"},{"internalType":"int24","name":"tickUpper","type":"int24"},{"internalType":"uint128","name":"liquidity","type":"uint128"},{"internalType":"address","name":"token","type":"address"}],"name":"forceWithdrawUniswapV3LiquidityAndToken","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes","name":"_data","type":"bytes"}],"name":"getHandlerIdentifier","outputs":[{"internalType":"uint256","name":"handlerIdentifierId","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"role","type":"bytes32"}],"name":"getRoleAdmin","outputs":[{"internalType":"bytes32","name":"","type":"bytes32"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"getTokenIdData","outputs":[{"components":[{"internalType":"uint128","name":"totalLiquidity","type":"uint128"},{"internalType":"uint128","name":"totalSupply","type":"uint128"},{"internalType":"uint128","name":"liquidityUsed","type":"uint128"},{"internalType":"uint256","name":"feeGrowthInside0LastX128","type":"uint256"},{"internalType":"uint256","name":"feeGrowthInside1LastX128","type":"uint256"},{"internalType":"uint128","name":"tokensOwed0","type":"uint128"},{"internalType":"uint128","name":"tokensOwed1","type":"uint128"},{"internalType":"uint64","name":"lastDonation","type":"uint64"},{"internalType":"uint128","name":"donatedLiquidity","type":"uint128"},{"internalType":"address","name":"token0","type":"address"},{"internalType":"address","name":"token1","type":"address"},{"internalType":"uint24","name":"fee","type":"uint24"},{"internalType":"uint128","name":"reservedLiquidity","type":"uint128"}],"internalType":"struct UniswapV3SingleTickLiquidityHandlerV2.TokenIdInfo","name":"","type":"tuple"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"role","type":"bytes32"},{"internalType":"address","name":"account","type":"address"}],"name":"grantRole","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes32","name":"role","type":"bytes32"},{"internalType":"address","name":"account","type":"address"}],"name":"hasRole","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"},{"internalType":"address","name":"","type":"address"}],"name":"isOperator","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"lockedBlockDuration","outputs":[{"internalType":"uint64","name":"","type":"uint64"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"context","type":"address"},{"internalType":"bytes","name":"_mintPositionData","type":"bytes"}],"name":"mintPositionHandler","outputs":[{"internalType":"uint256","name":"sharesMinted","type":"uint256"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"newLockedBlockDuration","outputs":[{"internalType":"uint64","name":"","type":"uint64"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"paused","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"role","type":"bytes32"},{"internalType":"address","name":"account","type":"address"}],"name":"renounceRole","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"reserveCooldown","outputs":[{"internalType":"uint64","name":"","type":"uint64"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes","name":"_reserveLiquidityParam","type":"bytes"}],"name":"reserveLiquidity","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"},{"internalType":"address","name":"","type":"address"}],"name":"reservedLiquidityPerUser","outputs":[{"internalType":"uint128","name":"liquidity","type":"uint128"},{"internalType":"uint64","name":"lastReserve","type":"uint64"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"role","type":"bytes32"},{"internalType":"address","name":"account","type":"address"}],"name":"revokeRole","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"operator","type":"address"},{"internalType":"bool","name":"approved","type":"bool"}],"name":"setOperator","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes4","name":"interfaceId","type":"bytes4"}],"name":"supportsInterface","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"tokenIds","outputs":[{"internalType":"uint128","name":"totalLiquidity","type":"uint128"},{"internalType":"uint128","name":"totalSupply","type":"uint128"},{"internalType":"uint128","name":"liquidityUsed","type":"uint128"},{"internalType":"uint256","name":"feeGrowthInside0LastX128","type":"uint256"},{"internalType":"uint256","name":"feeGrowthInside1LastX128","type":"uint256"},{"internalType":"uint128","name":"tokensOwed0","type":"uint128"},{"internalType":"uint128","name":"tokensOwed1","type":"uint128"},{"internalType":"uint64","name":"lastDonation","type":"uint64"},{"internalType":"uint128","name":"donatedLiquidity","type":"uint128"},{"internalType":"address","name":"token0","type":"address"},{"internalType":"address","name":"token1","type":"address"},{"internalType":"uint24","name":"fee","type":"uint24"},{"internalType":"uint128","name":"reservedLiquidity","type":"uint128"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes","name":"_donatePosition","type":"bytes"}],"name":"tokensToPullForDonate","outputs":[{"internalType":"address[]","name":"","type":"address[]"},{"internalType":"uint256[]","name":"","type":"uint256[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes","name":"_mintPositionData","type":"bytes"}],"name":"tokensToPullForMint","outputs":[{"internalType":"address[]","name":"","type":"address[]"},{"internalType":"uint256[]","name":"","type":"uint256[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes","name":"_unusePositionData","type":"bytes"}],"name":"tokensToPullForUnUse","outputs":[{"internalType":"address[]","name":"","type":"address[]"},{"internalType":"uint256[]","name":"","type":"uint256[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"receiver","type":"address"},{"internalType":"uint256","name":"id","type":"uint256"},{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"transfer","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"sender","type":"address"},{"internalType":"address","name":"receiver","type":"address"},{"internalType":"uint256","name":"id","type":"uint256"},{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"transferFrom","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"amount0Owed","type":"uint256"},{"internalType":"uint256","name":"amount1Owed","type":"uint256"},{"internalType":"bytes","name":"data","type":"bytes"}],"name":"uniswapV3MintCallback","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes","name":"_unusePositionData","type":"bytes"}],"name":"unusePositionHandler","outputs":[{"internalType":"uint256[]","name":"","type":"uint256[]"},{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint64","name":"_newLockedBlockDuration","type":"uint64"},{"internalType":"uint64","name":"_newReserveCooldown","type":"uint64"}],"name":"updateLockedBlockDurationAndReserveCooldown","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"_app","type":"address"},{"internalType":"bool","name":"_status","type":"bool"}],"name":"updateWhitelistedApps","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes","name":"_usePositionHandler","type":"bytes"}],"name":"usePositionHandler","outputs":[{"internalType":"address[]","name":"","type":"address[]"},{"internalType":"uint256[]","name":"","type":"uint256[]"},{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"whitelistedApps","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes","name":"_reserveLiquidityParam","type":"bytes"}],"name":"withdrawReserveLiquidity","outputs":[],"stateMutability":"nonpayable","type":"function"}]

const DOPEX_POSITION_MANAGER_ABI = [{"inputs":[],"name":"DopexV2PositionManager__NotWhitelistedApp","type":"error"},{"inputs":[],"name":"DopexV2PositionManager__NotWhitelistedHandler","type":"error"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"contract IHandler","name":"_handler","type":"address"},{"indexed":false,"internalType":"uint256","name":"tokenId","type":"uint256"},{"indexed":false,"internalType":"address","name":"user","type":"address"},{"indexed":false,"internalType":"uint256","name":"sharesBurned","type":"uint256"}],"name":"LogBurnPosition","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"contract IHandler","name":"_handler","type":"address"},{"indexed":false,"internalType":"uint256","name":"liquidityDonated","type":"uint256"}],"name":"LogDonation","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"contract IHandler","name":"_handler","type":"address"},{"indexed":false,"internalType":"uint256","name":"tokenId","type":"uint256"},{"indexed":false,"internalType":"address","name":"user","type":"address"},{"indexed":false,"internalType":"uint256","name":"sharesMinted","type":"uint256"}],"name":"LogMintPosition","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"contract IHandler","name":"_handler","type":"address"},{"indexed":false,"internalType":"uint256","name":"liquidityUnused","type":"uint256"}],"name":"LogUnusePosition","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"address","name":"_handler","type":"address"},{"indexed":false,"internalType":"bool","name":"_status","type":"bool"}],"name":"LogUpdateWhitelistHandler","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"address","name":"_handler","type":"address"},{"indexed":false,"internalType":"address","name":"_app","type":"address"},{"indexed":false,"internalType":"bool","name":"_status","type":"bool"}],"name":"LogUpdateWhitelistHandlerWithApp","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"contract IHandler","name":"_handler","type":"address"},{"indexed":false,"internalType":"uint256","name":"liquidityUsed","type":"uint256"}],"name":"LogUsePosition","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"previousOwner","type":"address"},{"indexed":true,"internalType":"address","name":"newOwner","type":"address"}],"name":"OwnershipTransferred","type":"event"},{"inputs":[{"internalType":"contract IHandler","name":"_handler","type":"address"},{"internalType":"bytes","name":"_burnPositionData","type":"bytes"}],"name":"burnPosition","outputs":[{"internalType":"uint256","name":"sharesBurned","type":"uint256"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"contract IHandler","name":"_handler","type":"address"},{"internalType":"bytes","name":"_donatePosition","type":"bytes"}],"name":"donateToPosition","outputs":[{"internalType":"uint256[]","name":"amounts","type":"uint256[]"},{"internalType":"uint256","name":"liquidity","type":"uint256"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"contract IHandler","name":"_handler","type":"address"},{"internalType":"bytes","name":"_mintPositionData","type":"bytes"}],"name":"mintPosition","outputs":[{"internalType":"uint256","name":"sharesMinted","type":"uint256"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes[]","name":"data","type":"bytes[]"}],"name":"multicall","outputs":[{"internalType":"bytes[]","name":"results","type":"bytes[]"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"owner","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"renounceOwnership","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"newOwner","type":"address"}],"name":"transferOwnership","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"contract IHandler","name":"_handler","type":"address"},{"internalType":"bytes","name":"_unusePositionData","type":"bytes"}],"name":"unusePosition","outputs":[{"internalType":"uint256[]","name":"amounts","type":"uint256[]"},{"internalType":"uint256","name":"liquidity","type":"uint256"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"_handler","type":"address"},{"internalType":"bool","name":"_status","type":"bool"}],"name":"updateWhitelistHandler","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"_handler","type":"address"},{"internalType":"address","name":"_app","type":"address"},{"internalType":"bool","name":"_status","type":"bool"}],"name":"updateWhitelistHandlerWithApp","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"contract IHandler","name":"_handler","type":"address"},{"internalType":"bytes","name":"_usePositionData","type":"bytes"}],"name":"usePosition","outputs":[{"internalType":"address[]","name":"tokens","type":"address[]"},{"internalType":"uint256[]","name":"amounts","type":"uint256[]"},{"internalType":"uint256","name":"liquidityUsed","type":"uint256"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"whitelistedHandlers","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"","type":"bytes32"}],"name":"whitelistedHandlersWithApp","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"}]

async function main() {
    const App = await init_ethers();

    _print(`Initialized ${App.YOUR_ADDRESS}\n`);
    _print("Reading smart contracts...\n");

    const positions = await getDopexData();

   const HANDLER_ADDRESS = '0x29bbf7ebb9c5146c98851e76a5529985e4052116';

   const HANDLER = new ethers.Contract(HANDLER_ADDRESS, HANDLER_ABI, App.provider);

   const DOPEX_POSITION_MANAGER_ADDRESS = '0xe4ba6740af4c666325d49b3112e4758371386adc';

   for(const position of positions){
      const poolDetails = await HANDLER.tokenIds(position.meta.tokenId);
      const totalLiquidity = poolDetails.totalLiquidity;
      const liquidityUsed = poolDetails.liquidityUsed;
      const withdrawableLiquidity = totalLiquidity - liquidityUsed;
      const pool_address = position.meta.handler.pool;
      const hook_address = position.meta.hook;
      const tick_lower = position.meta.tickLower;
      const tick_upper = position.meta.tickUpper;
      const token0 = position.tokens.token0;
      const token1 = position.tokens.token1;

      const byte_data = ethers.utils.solidityPack(["address", "address", "int24", "int24", "int128"], [pool_address, hook_address, tick_lower, tick_upper, withdrawableLiquidity])

      const withdraw = async function() {
        return dopexContract_withdraw(DOPEX_POSITION_MANAGER_ABI, DOPEX_POSITION_MANAGER_ADDRESS, HANDLER_ADDRESS, byte_data, App);
      }
    
       _print(`Pool: ${pool_address} - (${token0.symbol} / ${token1.symbol})`);
       _print(`Strikes: Call (${(position.strikes.call / 1).toFixed(2)}) Put (${(position.strikes.put / 1).toFixed(2)})`);
       _print(`Liquidity: ${token0.symbol} (${(position.liquidity.token0 / 10 ** token0.decimals).toFixed(2)}) ${token1.symbol} (${(position.liquidity.token1 / 10 ** token1.decimals).toFixed(2)})`);
       _print(`Earned: ${token0.symbol} (${(position.earned.token0 / 10 ** token0.decimals).toFixed(2)}) ${token1.symbol} (${(position.earned.token1 / 10 ** token1.decimals).toFixed(2)})`);
       _print(`Withdrawable: ${token0.symbol} (${(position.reserved.withdrawable.token0 / 10 ** token0.decimals).toFixed(2)}) ${token1.symbol} (${(position.reserved.withdrawable.token1 / 10 ** token1.decimals).toFixed(2)})`);
       _print(`Withdrawable Liquidity: ${withdrawableLiquidity}`);
       _print_link(`Withdraw`, withdraw);
       _print("");
   }

    hideLoading();
  }

const dopexContract_withdraw = async function(abi, address, handler_address, byte_data, App) {
    const signer = App.provider.getSigner()
    const CONTRACT = new ethers.Contract(address, abi, signer)
  
      showLoading()
      const t = await CONTRACT.burnPosition(handler_address, byte_data, { gasLimit: 5000000 });
      return App.provider.waitForTransaction(t.hash);
  }

const getDopexData = async function() {
  return await $.ajax({
    url: 'https://varrock.dopex.io/clamm/deposit/positions?chainId=42161&pool=0x0E4831319A50228B9e450861297aB92dee15B44F&user=0xa8D092b8b1A07EF7b8b409cEd7CFB13C0E46E439&first=100&skip=0',
    type: 'GET',
    headers: {
      'Access-Control-Allow-Methods': 'GET'
    }
   });
}